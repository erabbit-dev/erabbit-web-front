(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b07c032"],{1885:function(e,t,c){},"1c43":function(e,t,c){"use strict";c("1885")},"2f1e":function(e,t,c){"use strict";c("4599")},4599:function(e,t,c){},"54dc":function(e,t,c){},"8e10":function(e,t,c){"use strict";c("54dc")},df61:function(e,t,c){"use strict";c.r(t);var o=c("7a23");const a=e=>(Object(o["pushScopeId"])("data-v-ac29eec8"),e=e(),Object(o["popScopeId"])(),e),l={key:0,class:"container"},n=a(()=>Object(o["createElementVNode"])("div",{class:"unbind"},[Object(o["createElementVNode"])("div",{class:"loading"})],-1)),s=[n],r={key:1,class:"container"},i={class:"tab"},d=a(()=>Object(o["createElementVNode"])("i",{class:"iconfont icon-bind"},null,-1)),m=a(()=>Object(o["createElementVNode"])("span",null,"已有小兔鲜账号，请绑定手机",-1)),b=[d,m],u=a(()=>Object(o["createElementVNode"])("i",{class:"iconfont icon-edit"},null,-1)),j=a(()=>Object(o["createElementVNode"])("span",null,"没有小兔鲜账号，请完善资料",-1)),O=[u,j],p={key:0,class:"tab-content"},v={key:1,class:"tab-content"};function f(e,t,c,a,n,d){const m=Object(o["resolveComponent"])("LoginHeader"),u=Object(o["resolveComponent"])("CallbackBind"),j=Object(o["resolveComponent"])("CallbackPatch"),f=Object(o["resolveComponent"])("LoginFooter");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createVNode"])(m,null,{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])("联合登录")]),_:1}),a.isBind?(Object(o["openBlock"])(),Object(o["createElementBlock"])("section",l,s)):(Object(o["openBlock"])(),Object(o["createElementBlock"])("section",r,[Object(o["createElementVNode"])("nav",i,[Object(o["createElementVNode"])("a",{onClick:t[0]||(t[0]=e=>a.hasAccount=!0),class:Object(o["normalizeClass"])({active:a.hasAccount}),href:"javascript:;"},b,2),Object(o["createElementVNode"])("a",{onClick:t[1]||(t[1]=e=>a.hasAccount=!1),class:Object(o["normalizeClass"])({active:!a.hasAccount}),href:"javascript:;"},O,2)]),a.hasAccount?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",p,[Object(o["createVNode"])(u,{unionId:a.unionId},null,8,["unionId"])])):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",v,[Object(o["createVNode"])(j,{unionId:a.unionId},null,8,["unionId"])]))])),Object(o["createVNode"])(f)],64)}c("14d9");var V=c("cc8e"),k=c("136e");const h=e=>(Object(o["pushScopeId"])("data-v-5ca4600c"),e=e(),Object(o["popScopeId"])(),e),N={class:"user-info"},E=["src"],y={class:"xtx-form-item"},C={class:"field"},x=h(()=>Object(o["createElementVNode"])("i",{class:"icon iconfont icon-phone"},null,-1)),B={key:0,class:"error"},g={class:"xtx-form-item"},w={class:"field"},I=h(()=>Object(o["createElementVNode"])("i",{class:"icon iconfont icon-code"},null,-1)),S={key:0,class:"error"};function U(e,t,c,a,l,n){const s=Object(o["resolveComponent"])("Field"),r=Object(o["resolveComponent"])("Form");return Object(o["openBlock"])(),Object(o["createBlock"])(r,{ref:"formCom","validation-schema":a.mySchema,autocomplete:"off",class:"xtx-form"},{default:Object(o["withCtx"])(({errors:e})=>[Object(o["createElementVNode"])("div",N,[Object(o["createElementVNode"])("img",{src:a.avatar,alt:""},null,8,E),Object(o["createElementVNode"])("p",null,"Hi，"+Object(o["toDisplayString"])(a.nickname)+" 欢迎来小兔鲜，完成绑定后可以QQ账号一键登录哦~",1)]),Object(o["createElementVNode"])("div",y,[Object(o["createElementVNode"])("div",C,[x,Object(o["createVNode"])(s,{class:Object(o["normalizeClass"])([{err:e.mobile},"input"]),modelValue:a.form.mobile,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.mobile=e),name:"mobile",type:"text",placeholder:"绑定的手机号"},null,8,["class","modelValue"])]),e.mobile?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",B,Object(o["toDisplayString"])(e.mobile),1)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",g,[Object(o["createElementVNode"])("div",w,[I,Object(o["createVNode"])(s,{class:Object(o["normalizeClass"])([{err:e.code},"input"]),modelValue:a.form.code,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.code=e),name:"code",type:"text",placeholder:"短信验证码"},null,8,["class","modelValue"]),Object(o["createElementVNode"])("span",{onClick:t[2]||(t[2]=e=>a.send()),class:"code"},Object(o["toDisplayString"])(0===a.time?"发送验证码":a.time+"秒后发送"),1)]),e.code?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",S,Object(o["toDisplayString"])(e.code),1)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("a",{onClick:t[3]||(t[3]=e=>a.submit()),href:"javascript:;",class:"submit"},"立即绑定")]),_:1},8,["validation-schema"])}var F=c("691d"),_=c.n(F),P=c("7bb1"),D=c("9f94"),z=c("c24f"),L=c("7bbe"),Q=c("2f59"),A=c("5502"),H=c("6605"),q={name:"CallbackBind",components:{Form:P["b"],Field:P["a"]},props:{unionId:{type:String,default:""}},setup(e){const t=Object(o["ref"])("null"),c=Object(o["ref"])("null");_.a.Login.check()&&_.a.api("get_user_info").success(e=>{c.value=e.data.figureurl_qq_1,t.value=e.data.nickname});const a=Object(o["reactive"])({mobile:null,code:null}),l={mobile:D["a"].mobile,code:D["a"].code},n=Object(o["ref"])(null),s=Object(o["ref"])(0),{pause:r,resume:i}=Object(L["v"])(()=>{s.value--,s.value<=0&&r()},1e3,!1);Object(o["onUnmounted"])(()=>{r()});const d=async()=>{const e=l.mobile(a.mobile);!0===e?0===s.value&&Object(z["e"])(a.mobile).then(()=>{Object(Q["a"])({type:"success",text:"发送成功"}),s.value=60,i()}).catch(e=>{var t;Object(Q["a"])({type:"error",text:(null===(t=e.response.data)||void 0===t?void 0:t.message)||"发送失败"})}):n.value.setFieldError("mobile",e)},m=Object(A["b"])(),b=Object(H["d"])(),u=async()=>{const t=n.value.validate();t&&Object(z["f"])({unionId:e.unionId,...a}).then(e=>{const{id:t,account:c,avatar:o,mobile:a,nickname:l,token:n}=e.result;m.commit("user/setUser",{id:t,account:c,avatar:o,mobile:a,nickname:l,token:n}),m.dispatch("cart/mergeCart").then(()=>{b.push(m.state.user.redirectUrl),Object(Q["a"])({type:"success",text:"QQ绑定成功"})})}).catch(e=>{Object(Q["a"])({type:"error",text:"绑定失败"})})};return{nickname:t,avatar:c,form:a,mySchema:l,send:d,time:s,formCom:n,submit:u}}},J=(c("1c43"),c("6b0d")),M=c.n(J);const T=M()(q,[["render",U],["__scopeId","data-v-5ca4600c"]]);var G=T;const K=e=>(Object(o["pushScopeId"])("data-v-447e9f44"),e=e(),Object(o["popScopeId"])(),e),R={class:"xtx-form-item"},W={class:"field"},X=K(()=>Object(o["createElementVNode"])("i",{class:"icon iconfont icon-user"},null,-1)),Y={key:0,class:"error"},Z={class:"xtx-form-item"},$={class:"field"},ee=K(()=>Object(o["createElementVNode"])("i",{class:"icon iconfont icon-phone"},null,-1)),te={key:0,class:"error"},ce={class:"xtx-form-item"},oe={class:"field"},ae=K(()=>Object(o["createElementVNode"])("i",{class:"icon iconfont icon-code"},null,-1)),le={key:0,class:"error"},ne={class:"xtx-form-item"},se={class:"field"},re=K(()=>Object(o["createElementVNode"])("i",{class:"icon iconfont icon-lock"},null,-1)),ie={key:0,class:"error"},de={class:"xtx-form-item"},me={class:"field"},be=K(()=>Object(o["createElementVNode"])("i",{class:"icon iconfont icon-lock"},null,-1)),ue={key:0,class:"error"};function je(e,t,c,a,l,n){const s=Object(o["resolveComponent"])("Field"),r=Object(o["resolveComponent"])("Form");return Object(o["openBlock"])(),Object(o["createBlock"])(r,{ref:"formCom","validation-schema":a.mySchema,class:"xtx-form",autocomplete:"off"},{default:Object(o["withCtx"])(({errors:e})=>[Object(o["createElementVNode"])("div",R,[Object(o["createElementVNode"])("div",W,[X,Object(o["createVNode"])(s,{class:Object(o["normalizeClass"])([{err:e.account},"input"]),modelValue:a.form.account,"onUpdate:modelValue":t[0]||(t[0]=e=>a.form.account=e),name:"account",type:"text",placeholder:"请输入用户名"},null,8,["class","modelValue"])]),e.account?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Y,Object(o["toDisplayString"])(e.account),1)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",Z,[Object(o["createElementVNode"])("div",$,[ee,Object(o["createVNode"])(s,{class:Object(o["normalizeClass"])([{err:e.mobile},"input"]),modelValue:a.form.mobile,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.mobile=e),name:"mobile",type:"text",placeholder:"请输入手机号"},null,8,["class","modelValue"])]),e.mobile?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",te,Object(o["toDisplayString"])(e.mobile),1)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",ce,[Object(o["createElementVNode"])("div",oe,[ae,Object(o["createVNode"])(s,{class:Object(o["normalizeClass"])([{err:e.code},"input"]),modelValue:a.form.code,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.code=e),name:"code",type:"text",placeholder:"请输入验证码"},null,8,["class","modelValue"]),Object(o["createElementVNode"])("span",{onClick:t[3]||(t[3]=e=>a.send()),class:"code"},Object(o["toDisplayString"])(0===a.time?"发送验证码":a.time+"秒后发送"),1)]),e.code?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",le,Object(o["toDisplayString"])(e.code),1)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",ne,[Object(o["createElementVNode"])("div",se,[re,Object(o["createVNode"])(s,{class:Object(o["normalizeClass"])([{err:e.password},"input"]),modelValue:a.form.password,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.password=e),name:"password",type:"password",placeholder:"请输入密码"},null,8,["class","modelValue"])]),e.password?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ie,Object(o["toDisplayString"])(e.password),1)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("div",de,[Object(o["createElementVNode"])("div",me,[be,Object(o["createVNode"])(s,{class:Object(o["normalizeClass"])([{err:e.rePassword},"input"]),modelValue:a.form.rePassword,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.rePassword=e),name:"rePassword",type:"password",placeholder:"请确认密码"},null,8,["class","modelValue"])]),e.rePassword?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ue,Object(o["toDisplayString"])(e.rePassword),1)):Object(o["createCommentVNode"])("",!0)]),Object(o["createElementVNode"])("a",{onClick:t[6]||(t[6]=e=>a.submit()),href:"javascript:;",class:"submit"},"立即提交")]),_:1},8,["validation-schema"])}var Oe={name:"CallbackPatch",components:{Form:P["b"],Field:P["a"]},props:{unionId:{type:String,default:""}},setup(e){const t=Object(o["reactive"])({account:null,mobile:null,code:null,password:null,rePassword:null}),c={account:D["a"].accountApi,mobile:D["a"].mobile,code:D["a"].code,password:D["a"].password,rePassword:D["a"].rePassword},a=Object(o["ref"])(null),l=Object(o["ref"])(0),{pause:n,resume:s}=Object(L["v"])(()=>{l.value--,l.value<=0&&n()},1e3,!1);Object(o["onUnmounted"])(()=>{n()});const r=async()=>{const e=c.mobile(t.mobile);!0===e?0===l.value&&Object(z["h"])(t.mobile).then(()=>{Object(Q["a"])({type:"success",text:"发送成功"}),l.value=60,s()}).catch(e=>{var t;Object(Q["a"])({type:"error",text:(null===(t=e.response.data)||void 0===t?void 0:t.message)||"发送失败"})}):a.value.setFieldError("mobile",e)},i=Object(A["b"])(),d=Object(H["d"])(),m=async()=>{const c=a.value.validate();c&&Object(z["i"])({unionId:e.unionId,...t}).then(e=>{const{id:t,account:c,avatar:o,mobile:a,nickname:l,token:n}=e.result;i.commit("user/setUser",{id:t,account:c,avatar:o,mobile:a,nickname:l,token:n}),i.dispatch("cart/mergeCart").then(()=>{d.push(i.state.user.redirectUrl),Object(Q["a"])({type:"success",text:"QQ完善信息成功"})})}).catch(e=>{Object(Q["a"])({type:"error",text:"完善信息失败"})})};return{form:t,mySchema:c,formCom:a,time:l,send:r,submit:m}}};c("2f1e");const pe=M()(Oe,[["render",je],["__scopeId","data-v-447e9f44"]]);var ve=pe,fe={name:"LoginCallback",components:{LoginHeader:V["a"],LoginFooter:k["a"],CallbackBind:G,CallbackPatch:ve},setup(){const e=Object(o["ref"])(!0),t=Object(o["ref"])(!0),c=Object(A["b"])(),a=Object(H["d"])(),l=Object(o["ref"])(null);return _.a.Login.check()&&_.a.Login.getMe(e=>{l.value=e,Object(z["g"])(e).then(e=>{const{id:t,account:o,avatar:l,mobile:n,nickname:s,token:r}=e.result;c.commit("user/setUser",{id:t,account:o,avatar:l,mobile:n,nickname:s,token:r}),c.dispatch("cart/mergeCart").then(()=>{a.push(c.state.user.redirectUrl),Object(Q["a"])({type:"success",text:"QQ登录成功"})})}).catch(e=>{t.value=!1})}),{hasAccount:e,isBind:t,unionId:l}}};c("8e10");const Ve=M()(fe,[["render",f],["__scopeId","data-v-ac29eec8"]]);t["default"]=Ve}}]);
//# sourceMappingURL=chunk-2b07c032.224684fd.js.map